# ëŒ€ìš©ëŸ‰ ë°ì´í„° ì½ê¸°

### 1ï¸âƒ£ ëŒ€ìš©ëŸ‰ ë°ì´í„°ë¥¼ ì½ì–´ì˜¤ê¸°

âœ” ì†ŒìŠ¤ ì½”ë“œ (parser ì¸í„°í˜ì´ìŠ¤, SchoolParser í´ë˜ìŠ¤, FileController í´ë˜ìŠ¤)

ğŸ‘‡ School.java

```java
package com.bigdata.domain;

import java.time.LocalDateTime;

public class School {
    private String id;
    private String name;
    private String grade;
    private LocalDateTime anniversary;
    private String establishForm;
    private boolean mainSchool;
    private String operationalStatus;
    private String jiBunAddress;
    private String roadNameAddress;
    private String sidoOfficeOfEducationCode;
    private String sidoOfficeOfEducation;
    private String smallOfficeOfEducationCode;
    private String smallOfficeOfEducation;
    private Double latitude;  // ìœ„ë„
    private Double longitude;  // ê²½ë„

    public School() {
    }

    public School(String id, String name, String grade, LocalDateTime anniversary, String establishForm, boolean mainSchool, String operationalStatus, String jiBunAddress, String roadNameAddress, String sidoOfficeOfEducationCode, String sidoOfficeOfEducation, String smallOfficeOfEducationCode, String smallOfficeOfEducation, Double latitude, Double longitude) {
        this.id = id;
        this.name = name;
        this.grade = grade;
        this.anniversary = anniversary;
        this.establishForm = establishForm;
        this.mainSchool = mainSchool;
        this.operationalStatus = operationalStatus;
        this.jiBunAddress = jiBunAddress;
        this.roadNameAddress = roadNameAddress;
        this.sidoOfficeOfEducationCode = sidoOfficeOfEducationCode;
        this.sidoOfficeOfEducation = sidoOfficeOfEducation;
        this.smallOfficeOfEducationCode = smallOfficeOfEducationCode;
        this.smallOfficeOfEducation = smallOfficeOfEducation;
        this.latitude = latitude;
        this.longitude = longitude;
    }

    public String getId() {
        return id;
    }

    public String getName() {
        return name;
    }

    public String getGrade() {
        return grade;
    }

    public LocalDateTime getAnniversary() {
        return anniversary;
    }

    public String getEstablishForm() {
        return establishForm;
    }

    public boolean getMainSchool() {
        return mainSchool;
    }

    public String getOperationalStatus() {
        return operationalStatus;
    }

    public String getJiBunAddress() {
        return jiBunAddress;
    }

    public String getRoadNameAddress() {
        return roadNameAddress;
    }

    public String getSidoOfficeOfEducationCode() {
        return sidoOfficeOfEducationCode;
    }

    public String getSidoOfficeOfEducation() {
        return sidoOfficeOfEducation;
    }

    public String getSmallOfficeOfEducationCode() {
        return smallOfficeOfEducationCode;
    }

    public String getSmallOfficeOfEducation() {
        return smallOfficeOfEducation;
    }

    public Double getLatitude() {
        return latitude;
    }

    public Double getLongitude() {
        return longitude;
    }
}

```

ğŸ‘‡ Parser.java

```java
package com.bigdata.parser;

import com.bigdata.domain.School;

public interface Parser<T> {
    T parse(String str);
}
```

ğŸ‘‡ SchoolParser.java

```java
package com.bigdata.parser;

import com.bigdata.domain.School;

public class SchoolParser implements Parser<School>{

    @Override
    public School parse(String str) {
        System.out.println(str);

        return new School();
    }
}
```

ğŸ‘‡ FileController.java

```java
package com.bigdata.parser;

import org.mozilla.universalchardet.UniversalDetector;

import java.io.*;
import java.util.ArrayList;
import java.util.List;

public class FileController<T> {

    Parser<T> parser;

    public FileController(Parser<T> parser) {
        this.parser = parser;
    }

    public String findFileEncoding(String path) throws IOException {
        byte[] buf = new byte[4096];
        FileInputStream fis = new FileInputStream(new File(path));

        UniversalDetector detector = new UniversalDetector(null);

        int bufSize;
        while ((bufSize = fis.read(buf)) > 0 && !detector.isDone()) {
            detector.handleData(buf, 0, bufSize);
        }

        detector.dataEnd();

        String encoding = detector.getDetectedCharset();
        if (encoding != null) {
            System.out.println("Detected encoding = " + encoding);
        } else {
            System.out.println("No encoding detected.");
        }

        detector.reset();

        return encoding;
    }

    public List<T> readLines(String path, String encoding) throws IOException {
        List<T> fileContents = new ArrayList<>();

        BufferedReader br;


        br = new BufferedReader(new InputStreamReader(new FileInputStream(path), encoding));
        String line;
        br.readLine();
        while((line = br.readLine()) != null) {
            fileContents.add(parser.parse(line));
        }

        return fileContents;
    }
}
```



### ğŸ“’ ì˜¤ëŠ˜ì˜ íšŒê³ 

ëŒ€ìš©ëŸ‰ íŒŒì¼ì„ ì½ì–´ì˜¤ëŠ” ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ëŠ” ê³¼ì •ì—ì„œ íŒŒì¼ì˜ ì¸ì½”ë”©ì„ ì˜ ëª°ë¼ì„œ ê³„ì†  **java.nio.charset.MalformedInputException : Input length = 1** ì—ëŸ¬ê°€ ë°œìƒí•˜ì˜€ë‹¤. 

ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ì½ì–´ì˜¤ê³ ì í•˜ëŠ” íŒŒì¼ì˜ ì¸ì½”ë”©ì„ í™•ì¸í•˜ëŠ” ë²•ì„ ì°¾ì•„ì„œ ì ìš©í•´ë³´ëŠ” ì‹œê°„ì„ ê°€ì¡Œë‹¤.

https://code.google.com/archive/p/juniversalchardet/

ğŸ‘† ìœ„ì˜ ì‚¬ì´íŠ¸ì—ì„œ juniversalchardet-1.0.3.jar íŒŒì¼ì„ ë‹¤ìš´ë¡œë“œ ë°›ì•„ ì˜ì¡´ì„±ì„ ì¶”ê°€í•´ì£¼ì—ˆë‹¤.

ê·¸ë¦¬ê³  Fileì„ ë‹¤ë£¨ê¸° ìœ„í•œ í´ë˜ìŠ¤ì¸ FileController.javaì˜ findFileEncoding() ë©”ì„œë“œì™€ ì´ë¥¼ í…ŒìŠ¤íŠ¸í•˜ê¸° ìœ„í•œ FileControllerTest.javaì˜ findFileEncoding() ë©”ì„œë“œë¥¼ ì‘ì„±í•˜ì—¬ í™•ì¸í•˜ì˜€ë‹¤.

```java
 public String findFileEncoding(String path) throws IOException {
    byte[] buf = new byte[4096];
    FileInputStream fis = new FileInputStream(new File(path));

    UniversalDetector detector = new UniversalDetector(null);

    int bufSize;
    while ((bufSize = fis.read(buf)) > 0 && !detector.isDone()) {
        detector.handleData(buf, 0, bufSize);
    }

    detector.dataEnd();

    String encoding = detector.getDetectedCharset();
    if (encoding != null) {
        System.out.println("Detected encoding = " + encoding);
    } else {
        System.out.println("No encoding detected.");
    }

    detector.reset();

    return encoding;
}
```

```java
package com.bigdata.parser;

import com.bigdata.domain.School;
import org.junit.jupiter.api.DisplayName;
import org.junit.jupiter.api.Test;

import java.io.IOException;

import static org.junit.jupiter.api.Assertions.*;

class FileControllerTest {
    FileController<School> fileController;
    String path;


    @Test
    @DisplayName("ì¸ì½”ë”© í™•ì¸ í…ŒìŠ¤íŠ¸")
    void findFlieEncoding() throws IOException {
        path = "C:\\pjt\\ì „êµ­ì´ˆì¤‘ë“±í•™êµìœ„ì¹˜í‘œì¤€ë°ì´í„°.csv";
        fileController = new FileController(new SchoolParser());

        String encoding = fileController.findFileEncoding(path);
        System.out.println(encoding);  // í˜„ì¬ íŒŒì¼ ì¸ì½”ë”©ì´ ë¬´ì—‡ì¸ì§€ ì¶œë ¥í•´ë³´ê¸°
        assertNotEquals("UTF-8", encoding);
    }

}
```



**ğŸ’¡ ì‹¤í–‰ ê²°ê³¼**

![image-20221105210707082](./assets/image-20221105210707082.png)

ì´ë ‡ê²Œ ì˜¤ëŠ˜ì€ ê¹”ë”í•˜ê²Œ ëŒ€ìš©ëŸ‰ íŒŒì¼ì„ ì½ì–´ì˜¤ëŠ” ê²ƒì„ ë°°ìš¸ ìˆ˜ ìˆì—ˆë‹¤. âœŒğŸ˜ŠâœŒ